# {unhcrreports}: AI-Powered Humanitarian Reporting

> \[!IMPORTANT\] **Reporting Engine**: This package functions as the
> “Reporting Engine” for UNHCR statistics. It focuses on **orchestrating
> automated reports** by combining data, visualization, and AI
> narratives.
>
> **Graphics Source**: The standardized charts used in these reports are
> built upon the styles and foundations provided by the
> [unhcrthemes](https://github.com/vidonne/unhcrthemes) package.

`unhcrreports` automates the production of analytical reports (Country
and Regional) by: 1. **Retrieving Data**: Fetching the latest official
statistics via the `refugees` package. 2. **Visualizing Trends**:
Generating standardized plots (powered by `unhcrthemes`). 3.
**Generating Narratives**: Using Large Language Models (LLMs) to
interpret data and write context-aware insights. 4. **Publishing**:
Compiling everything into polished Quarto reports.

## Installation

This package is built with the help of
[{fusen}](https://thinkr-open.github.io/fusen/) package which allows to
maintain consistent documentation through notebooks ( cf `dev` folder).
You can install it from GitHub with:

``` r
# Install from GitHub
devtools::install_github("matheus-hardt/unhcrreports")

# Install from local source
devtools::install(".")
## Main function
unhcrreports::generate_report(type = "country", name = "BRA", gp_provider ="azure", gp_model = "gpt-4.1-mini" )
```

## Setup

### 1. API Keys for AI Summaries

To enable AI-generated narratives, you need to set up an API key for a
supported LLM provider. The package supports OpenAI, Google Gemini,
Anthropic, and Ollama.

Set your API key as an environment variable. You can do this in your
`.Renviron` file or in your R session:

``` r
# For Google Gemini
Sys.setenv(GEMINI_API_KEY = "your_api_key_here")

# For OpenAI
Sys.setenv(OPENAI_API_KEY = "your_api_key_here")

# For Anthropic
Sys.setenv(ANTHROPIC_API_KEY = "your_api_key_here")
```

### 2. Using Ollama (Local LLM)

If you prefer to run a local model using Ollama:

1.  **Install Ollama**: Download from [ollama.com](https://ollama.com).
2.  **Pull a Model**: Open your terminal and pull a model (e.g.,
    `qwen2.5:32b` or `llama3`).

``` bash
ollama pull qwen2.5:32b
```

# Package index

## All functions

- [`clean_llm_response()`](https://matheus-hardt.github.io/unhcrreports/reference/clean_llm_response.md)
  : Clean LLM Response
- [`extract_structure()`](https://matheus-hardt.github.io/unhcrreports/reference/extract_structure.md)
  : Extract Plot Structure and Metadata (Phase 1)
- [`generate_description()`](https://matheus-hardt.github.io/unhcrreports/reference/generate_description.md)
  : Generate Plot Description with AI (Phase 3)
- [`generate_plot_story()`](https://matheus-hardt.github.io/unhcrreports/reference/generate_plot_story.md)
  : Generate Humanitarian Data Story from ggplot
- [`generate_report()`](https://matheus-hardt.github.io/unhcrreports/reference/generate_report.md)
  : Generate Quarto HTML / PDF Country Factsheets in Batch
- [`generate_report_summary()`](https://matheus-hardt.github.io/unhcrreports/reference/generate_report_summary.md)
  : Generate Report Executive Summary
- [`generate_section_summary()`](https://matheus-hardt.github.io/unhcrreports/reference/generate_section_summary.md)
  : Generate Section Summary from Plot Stories
- [`plot_ctr_asylum()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_asylum.md)
  : Asylum Applications & Decision over time
- [`plot_ctr_destination()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_destination.md)
  : Main Destination from one specific countr
- [`plot_ctr_diff_in_pop_groups()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_diff_in_pop_groups.md)
  : Increases and Decreases in Population Groups
- [`plot_ctr_disp_migrant()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_disp_migrant.md)
  : Plotting ratio Refugee/Asylum-seekers vs Migrant within a country
- [`plot_ctr_keyfig()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_keyfig.md)
  : Summary Key Figures
- [`plot_ctr_location()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_location.md)
  : Create a map with symbol proportional to population data by location
  within country
- [`plot_ctr_origin_history()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_origin_history.md)
  : Plot Origin History
- [`plot_ctr_origin_recognition()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_origin_recognition.md)
  : Display A Chart with Refugee Recognition Rate for nationals from a
  specific country
- [`plot_ctr_population_type_abs()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_population_type_abs.md)
  : Main country of origin - Absolute value
- [`plot_ctr_population_type_per_year()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_population_type_per_year.md)
  : Graph of Population Type Over year
- [`plot_ctr_population_type_perc()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_population_type_perc.md)
  : Main country of origin - Percentage
- [`plot_ctr_process()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_process.md)
  : Asylum Processing
- [`plot_ctr_processing_time()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_processing_time.md)
  : Plot Average processing time from registration to first instance
  asylum decision
- [`plot_ctr_pyramid()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_pyramid.md)
  : Population Pyramid
- [`plot_ctr_recognition()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_recognition.md)
  : Display a Chart with Refugee Recognition Rates
- [`plot_ctr_solution()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_solution.md)
  : Plotting solutions within a country
- [`plot_ctr_solution_recognition()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_solution_recognition.md)
  : Title
- [`plot_ctr_treemap()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_ctr_treemap.md)
  : Tree map of Population Groups within a country
- [`plot_reg_decrease()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_decrease.md)
  : Plot Biggest decrease in Refugee Population
- [`plot_reg_increase()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_increase.md)
  : Plot Biggest Increase in Refugee Population
- [`plot_reg_map()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_map.md)
  : Plot a regional map
- [`plot_reg_origin_dest()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_origin_dest.md)
  : Plot Population Origin-Destination within the region
- [`plot_reg_population_type_per_year()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_population_type_per_year.md)
  : Evolution over time
- [`plot_reg_prop_origin()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_prop_origin.md)
  : Proportion of the population who are refugees, by country of origin
- [`plot_reg_rsd()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_rsd.md)
  : Plot Chart on Refugee Status Determination
- [`plot_reg_share()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_share.md)
  : A simple chart to compare a population group between the Region and
  the rest of the world
- [`plot_reg_solution()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_solution.md)
  : Plot Solution over time in the region
- [`plot_reg_treemap()`](https://matheus-hardt.github.io/unhcrreports/reference/plot_reg_treemap.md)
  : Population group in the region
- [`profile_data()`](https://matheus-hardt.github.io/unhcrreports/reference/profile_data.md)
  : Profile Plot Data (Phase 2)
- [`slugify()`](https://matheus-hardt.github.io/unhcrreports/reference/slugify.md)
  : slugify

# Articles

### All vignettes

- [AI Powered
  Reports](https://matheus-hardt.github.io/unhcrreports/articles/ai-powered-reports.md):
- [AI Reporting and Rendering
  Functions](https://matheus-hardt.github.io/unhcrreports/articles/ai-reporting-and-rendering-functions.md):
- [Analysis with
  AI](https://matheus-hardt.github.io/unhcrreports/articles/analysis-with-ai.md):
- [Country Report
  Visualizations](https://matheus-hardt.github.io/unhcrreports/articles/country-report-visualizations.md):
- [Generate
  Reports](https://matheus-hardt.github.io/unhcrreports/articles/generate-reports.md):
- [Get Started: Generating
  Reports](https://matheus-hardt.github.io/unhcrreports/articles/how-to-generate-report.md):
- [Regional Report
  Visualizations](https://matheus-hardt.github.io/unhcrreports/articles/regional-report-visualizations.md):
